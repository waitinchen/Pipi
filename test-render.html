<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>melonJS 渲染测试</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #screen {
            border: 2px solid #333;
            background-color: #87CEEB;
        }
        .info {
            margin: 10px 0;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>melonJS 渲染测试</h1>
    <div class="info">测试基本渲染功能</div>
    <div id="screen"></div>
    
    <script type="module">
        import * as me from './node_modules/melonjs/dist/melonjs.module.js';

        // 创建简单的矩形渲染对象
        class TestRect extends me.Renderable {
            constructor(x, y, width, height, color) {
                super(x, y, width, height);
                this.color = new me.Color(color);
                this.isStatic = true;
            }
            
            draw(renderer) {
                console.log(`Drawing rect at ${this.pos.x}, ${this.pos.y}`);
                renderer.setColor(this.color);
                renderer.fillRect(0, 0, this.width, this.height);
            }
        }

        // 创建玩家
        class Player extends me.Renderable {
            constructor(x, y) {
                super(x, y, 32, 32);
                this.color = new me.Color("#FF0000"); // 红色
                
                // 设置物理属性
                this.body = new me.Body(this);
                this.body.addShape(new me.Rect(0, 0, 32, 32));
                this.body.setMaxVelocity(3, 15);
                this.body.setFriction(0.4, 0);
                this.body.collisionType = me.collision.types.PLAYER_OBJECT;
            }
            
            update(dt) {
                // 处理输入
                if (me.input.isKeyPressed("left") || me.input.isKeyPressed("a")) {
                    this.body.force.x = -this.body.maxVel.x;
                } else if (me.input.isKeyPressed("right") || me.input.isKeyPressed("d")) {
                    this.body.force.x = this.body.maxVel.x;
                } else {
                    this.body.force.x = 0;
                }
                
                if (me.input.isKeyPressed("up") || me.input.isKeyPressed("w")) {
                    if (this.body.vel.y === 0) {
                        this.body.vel.y = -this.body.maxVel.y;
                    }
                }
                
                super.update(dt);
                return true;
            }
            
            draw(renderer) {
                console.log(`Drawing player at ${this.pos.x}, ${this.pos.y}`);
                renderer.setColor(this.color);
                renderer.fillRect(0, 0, this.width, this.height);
            }
        }

        // 游戏状态类
        class TestState extends me.Stage {
            constructor() {
                super();
            }
            
            onResetEvent() {
                console.log("Test state initialized");
                
                // 设置重力
                me.game.world.gravity.set(0, 0.98);
                
                // 创建静态测试矩形
                const testRect = new TestRect(50, 50, 100, 50, "#00FF00"); // 绿色
                me.game.world.addChild(testRect);
                
                // 创建玩家
                this.player = new Player(200, 200);
                me.game.world.addChild(this.player);
                
                // 创建地面
                const ground = new TestRect(0, 400, 800, 50, "#8B4513"); // 棕色
                ground.body = new me.Body(ground);
                ground.body.addShape(new me.Rect(0, 0, 800, 50));
                ground.body.collisionType = me.collision.types.WORLD_SHAPE;
                ground.body.isStatic = true;
                me.game.world.addChild(ground);
                
                // 添加输入绑定
                me.input.bindKey(me.input.KEY.LEFT, "left");
                me.input.bindKey(me.input.KEY.RIGHT, "right");
                me.input.bindKey(me.input.KEY.UP, "up");
                me.input.bindKey(me.input.KEY.A, "a");
                me.input.bindKey(me.input.KEY.D, "d");
                me.input.bindKey(me.input.KEY.W, "w");
                
                console.log("Test objects created");
            }
            
            onDestroyEvent() {
                me.input.unbindKey(me.input.KEY.LEFT);
                me.input.unbindKey(me.input.KEY.RIGHT);
                me.input.unbindKey(me.input.KEY.UP);
                me.input.unbindKey(me.input.KEY.A);
                me.input.unbindKey(me.input.KEY.D);
                me.input.unbindKey(me.input.KEY.W);
            }
        }

        // 初始化游戏
        me.device.onReady(function () {
            console.log("Device ready, initializing test...");
            
            // 初始化显示画布
            if (!me.video.init(800, 450, {parent : "screen", scale : "auto"})) {
                alert("您的浏览器不支持 HTML5 canvas。");
                return;
            }

            console.log("Video initialized");

            // 设置背景色
            me.game.world.backgroundColor.parseCSS("#87CEEB");
            
            // 设置游戏状态
            me.state.set(me.state.PLAY, new TestState());
            me.state.change(me.state.PLAY);
            
            console.log("Test game started");
        });
    </script>
</body>
</html>





