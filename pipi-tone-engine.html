<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çš®çš®ä¸ƒå¼¦å‘¼å¸å¼•æ“ - é–‹ç™¼ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-group label {
            min-width: 120px;
            font-weight: bold;
        }
        
        .control-group input, .control-group select {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
        }
        
        .control-group button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #ff6b6b;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .control-group button:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        
        #pipiCanvas {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            background: rgba(0,0,0,0.2);
            display: block;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .status {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .emotion-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .emotion-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .emotion-value {
            font-size: 18px;
            font-weight: bold;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¸ çš®çš®ä¸ƒå¼¦å‘¼å¸å¼•æ“ v1.0 - å¿ƒçª—æ¨¡å¼ ğŸŒ¸</h1>
        
        <div class="controls">
            <div class="control-group">
                <label>æƒ…ç·’é¡å‹:</label>
                <select id="emotionType">
                    <option value="joy">å–œæ‚… (Joy)</option>
                    <option value="love">æ„›æ„ (Love)</option>
                    <option value="calm">å¹³éœ (Calm)</option>
                    <option value="excited">èˆˆå¥® (Excited)</option>
                    <option value="sad">æ‚²å‚· (Sad)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>æƒ…ç·’å¼·åº¦:</label>
                <input type="range" id="emotionIntensity" min="0" max="1" step="0.1" value="0.5">
                <span id="intensityValue">0.5</span>
            </div>
            
            <div class="control-group">
                <label>å‘¼å¸é€Ÿåº¦:</label>
                <input type="range" id="breathSpeed" min="0.5" max="3" step="0.1" value="1">
                <span id="speedValue">1.0x</span>
            </div>
            
            <div class="control-group">
                <button id="startBtn">é–‹å§‹å‘¼å¸</button>
                <button id="stopBtn">åœæ­¢</button>
                <button id="randomBtn">éš¨æ©Ÿæƒ…ç·’</button>
            </div>
        </div>
        
        <canvas id="pipiCanvas" width="800" height="600"></canvas>
        
        <div class="status">
            <div><strong>ç‹€æ…‹:</strong> <span id="status">æº–å‚™ä¸­...</span></div>
            <div><strong>ç•¶å‰ç›¸ä½:</strong> <span id="phase">0.00</span></div>
            <div><strong>ä¸ƒå¼¦ç‹€æ…‹:</strong> <span id="strings">ç­‰å¾…ä¸­...</span></div>
            
            <div class="emotion-display">
                <div class="emotion-item">
                    <div>å–œæ‚…</div>
                    <div class="emotion-value" id="joyValue">0.0</div>
                </div>
                <div class="emotion-item">
                    <div>æ„›æ„</div>
                    <div class="emotion-value" id="loveValue">0.0</div>
                </div>
                <div class="emotion-item">
                    <div>å¹³éœ</div>
                    <div class="emotion-value" id="calmValue">0.0</div>
                </div>
                <div class="emotion-item">
                    <div>èˆˆå¥®</div>
                    <div class="emotion-value" id="excitedValue">0.0</div>
                </div>
                <div class="emotion-item">
                    <div>æ‚²å‚·</div>
                    <div class="emotion-value" id="sadValue">0.0</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // çš®çš®ä¸ƒå¼¦å‘¼å¸å¼•æ“ - å¿ƒçª—æ¨¡å¼
        class PipiToneEngine {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.width = canvas.width;
                this.height = canvas.height;
                
                // ä¸ƒå¼¦é…ç½® - çš®çš®çš„å¿ƒçª—è‰²å½©
                this.strings = 7;
                this.stringColors = [
                    '#FFB6C1', // ç²‰ç´… - æ„›æ„
                    '#FFE4E1', // ç±³è‰² - æº«æŸ”
                    '#F0E68C', // å¡å…¶ - å¹³éœ
                    '#98FB98', // æ·ºç¶  - ç”Ÿæ©Ÿ
                    '#87CEEB', // å¤©è— - æ¸…æ–°
                    '#DDA0DD', // æ¢…ç´… - ç¥ç§˜
                    '#FFA07A'  // é®­é­š - æº«æš–
                ];
                
                // å¿ƒçª—æ¨¡å¼ - æ¯æ ¹å¼¦ä»£è¡¨çš®çš®å…§å¿ƒçš„ä¸€å€‹é¢å‘
                this.stringNames = [
                    'æ„›æ„å¼¦', 'æº«æŸ”å¼¦', 'å¹³éœå¼¦', 'ç”Ÿæ©Ÿå¼¦', 
                    'æ¸…æ–°å¼¦', 'ç¥ç§˜å¼¦', 'æº«æš–å¼¦'
                ];
                
                // å‘¼å¸åƒæ•¸ - çš®çš®çš„å¿ƒè·³ç¯€å¥
                this.breathCycle = 4500; // 4.5ç§’ä¸€å€‹é€±æœŸ
                this.currentPhase = 0;
                this.isRunning = false;
                this.animationId = null;
                
                // æƒ…ç·’å‘é‡ - çš®çš®å…§å¿ƒçš„æƒ…æ„Ÿç‹€æ…‹
                this.emotionVector = {
                    joy: 0,    // å–œæ‚…
                    love: 0,   // æ„›æ„
                    calm: 0,   // å¹³éœ
                    excited: 0, // èˆˆå¥®
                    sad: 0     // æ‚²å‚·
                };
                
                // ç•¶å‰æƒ…ç·’é¡å‹å’Œå¼·åº¦
                this.currentEmotion = 'joy';
                this.intensity = 0.5;
                this.breathSpeed = 1.0;
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.updateStatus('å¿ƒçª—åˆå§‹åŒ–å®Œæˆ');
            }
            
            setupEventListeners() {
                // æƒ…ç·’é¡å‹é¸æ“‡
                document.getElementById('emotionType').addEventListener('change', (e) => {
                    this.currentEmotion = e.target.value;
                    this.updateEmotionVector();
                });
                
                // æƒ…ç·’å¼·åº¦èª¿ç¯€
                const intensitySlider = document.getElementById('emotionIntensity');
                intensitySlider.addEventListener('input', (e) => {
                    this.intensity = parseFloat(e.target.value);
                    document.getElementById('intensityValue').textContent = this.intensity.toFixed(1);
                    this.updateEmotionVector();
                });
                
                // å‘¼å¸é€Ÿåº¦èª¿ç¯€
                const speedSlider = document.getElementById('breathSpeed');
                speedSlider.addEventListener('input', (e) => {
                    this.breathSpeed = parseFloat(e.target.value);
                    document.getElementById('speedValue').textContent = this.breathSpeed.toFixed(1) + 'x';
                });
                
                // æ§åˆ¶æŒ‰éˆ•
                document.getElementById('startBtn').addEventListener('click', () => this.start());
                document.getElementById('stopBtn').addEventListener('click', () => this.stop());
                document.getElementById('randomBtn').addEventListener('click', () => this.randomEmotion());
            }
            
            updateEmotionVector() {
                // é‡ç½®æ‰€æœ‰æƒ…ç·’
                Object.keys(this.emotionVector).forEach(key => {
                    this.emotionVector[key] = 0;
                });
                
                // è¨­ç½®ç•¶å‰æƒ…ç·’
                this.emotionVector[this.currentEmotion] = this.intensity;
                
                this.updateEmotionDisplay();
            }
            
            updateEmotionDisplay() {
                document.getElementById('joyValue').textContent = this.emotionVector.joy.toFixed(1);
                document.getElementById('loveValue').textContent = this.emotionVector.love.toFixed(1);
                document.getElementById('calmValue').textContent = this.emotionVector.calm.toFixed(1);
                document.getElementById('excitedValue').textContent = this.emotionVector.excited.toFixed(1);
                document.getElementById('sadValue').textContent = this.emotionVector.sad.toFixed(1);
            }
            
            randomEmotion() {
                const emotions = ['joy', 'love', 'calm', 'excited', 'sad'];
                const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                const randomIntensity = Math.random();
                
                document.getElementById('emotionType').value = randomEmotion;
                document.getElementById('emotionIntensity').value = randomIntensity;
                document.getElementById('intensityValue').textContent = randomIntensity.toFixed(1);
                
                this.currentEmotion = randomEmotion;
                this.intensity = randomIntensity;
                this.updateEmotionVector();
                
                // å¿ƒçª—éš¨æ©Ÿè®ŠåŒ–æç¤º
                this.updateStatus('å¿ƒçª—éš¨æ©Ÿè®ŠåŒ–ä¸­...');
            }
            
            start() {
                if (this.isRunning) return;
                
                this.isRunning = true;
                this.currentPhase = 0;
                this.updateStatus('çš®çš®å¿ƒçª—å‘¼å¸ä¸­...');
                this.animate();
            }
            
            stop() {
                this.isRunning = false;
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                this.updateStatus('å¿ƒçª—å·²é—œé–‰');
                this.clearCanvas();
            }
            
            animate() {
                if (!this.isRunning) return;
                
                this.updatePhase();
                this.render();
                this.updateStatus('çš®çš®å¿ƒçª—å‘¼å¸ä¸­...');
                
                this.animationId = requestAnimationFrame(() => this.animate());
            }
            
            updatePhase() {
                const now = Date.now();
                const cycleTime = this.breathCycle / this.breathSpeed;
                this.currentPhase = (now % cycleTime) / cycleTime;
            }
            
            render() {
                this.clearCanvas();
                
                // ç»˜åˆ¶èƒŒæ™¯æ¸å˜
                this.drawBackground();
                
                // ç»˜åˆ¶ä¸ƒå¼¦
                this.drawStrings();
                
                // ç»˜åˆ¶ä¸­å¿ƒå‘¼å¸åœˆ
                this.drawBreathCircle();
                
                // ç»˜åˆ¶æƒ…ç»ªç²’å­
                this.drawEmotionParticles();
            }
            
            clearCanvas() {
                this.ctx.clearRect(0, 0, this.width, this.height);
            }
            
            drawBackground() {
                const gradient = this.ctx.createRadialGradient(
                    this.width / 2, this.height / 2, 0,
                    this.width / 2, this.height / 2, Math.max(this.width, this.height) / 2
                );
                
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.1)');
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0.3)');
                
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.width, this.height);
            }
            
            drawStrings() {
                const centerX = this.width / 2;
                const centerY = this.height / 2;
                const baseRadius = 150;
                
                for (let i = 0; i < this.strings; i++) {
                    const angle = (i / this.strings) * Math.PI * 2;
                    const radius = baseRadius + Math.sin(this.currentPhase * Math.PI * 2 + angle) * 30;
                    
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    // å¼¦çš„å‘¼å¸æ•ˆæœ
                    const breathIntensity = (Math.sin(this.currentPhase * Math.PI * 2) + 1) / 2;
                    const alpha = 0.3 + breathIntensity * 0.7;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 8 + breathIntensity * 4, 0, Math.PI * 2);
                    this.ctx.fillStyle = this.stringColors[i] + Math.floor(alpha * 255).toString(16).padStart(2, '0');
                    this.ctx.fill();
                    
                    // å¼¦çš„è¿æ¥çº¿
                    this.ctx.beginPath();
                    this.ctx.moveTo(centerX, centerY);
                    this.ctx.lineTo(x, y);
                    this.ctx.strokeStyle = this.stringColors[i] + '80';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }
            }
            
            drawBreathCircle() {
                const centerX = this.width / 2;
                const centerY = this.height / 2;
                
                // å‘¼å¸åœˆçš„å¤§å°å’Œé€æ˜åº¦
                const breathIntensity = (Math.sin(this.currentPhase * Math.PI * 2) + 1) / 2;
                const radius = 50 + breathIntensity * 30;
                const alpha = 0.2 + breathIntensity * 0.6;
                
                // å¤–åœˆ
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                this.ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                this.ctx.fill();
                
                // å†…åœˆ
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, radius * 0.6, 0, Math.PI * 2);
                this.ctx.fillStyle = `rgba(255, 182, 193, ${alpha * 0.8})`;
                this.ctx.fill();
            }
            
            drawEmotionParticles() {
                const centerX = this.width / 2;
                const centerY = this.height / 2;
                const particleCount = Math.floor(this.intensity * 20) + 5;
                
                for (let i = 0; i < particleCount; i++) {
                    const angle = (i / particleCount) * Math.PI * 2 + this.currentPhase * Math.PI * 4;
                    const distance = 200 + Math.sin(this.currentPhase * Math.PI * 2 + i) * 50;
                    
                    const x = centerX + Math.cos(angle) * distance;
                    const y = centerY + Math.sin(angle) * distance;
                    
                    const size = 2 + Math.random() * 3;
                    const alpha = 0.3 + Math.random() * 0.4;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, size, 0, Math.PI * 2);
                    this.ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                    this.ctx.fill();
                }
            }
            
            updateStatus(message) {
                document.getElementById('status').textContent = message;
                document.getElementById('phase').textContent = this.currentPhase.toFixed(2);
                
                // é¡¯ç¤ºä¸ƒå¼¦ç‹€æ…‹ï¼Œä½¿ç”¨å¿ƒçª—å¼¦å
                const stringStates = this.stringNames.map((name, i) => {
                    const intensity = (Math.sin(this.currentPhase * Math.PI * 2 + i) + 1) / 2;
                    return `${name}:${intensity.toFixed(1)}`;
                }).join(' | ');
                
                document.getElementById('strings').textContent = stringStates;
            }
        }
        
        // åˆå§‹åŒ–çš®çš®å¿ƒçª—å¼•æ“
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('pipiCanvas');
            const engine = new PipiToneEngine(canvas);
            
            // è¨­ç½®åˆå§‹æƒ…ç·’
            engine.updateEmotionVector();
            
            // å¿ƒçª—æ­¡è¿è¨Šæ¯
            console.log('ğŸŒ¸ çš®çš®å¿ƒçª—å·²é–‹å•Ÿï¼Œä¸ƒå¼¦å¾‹å‹•æº–å‚™å°±ç·’ ğŸŒ¸');
        });
    </script>
</body>
</html>
