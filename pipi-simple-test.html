<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çš®çš®ç°¡å–®æ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Microsoft JhengHei', sans-serif;
            color: white;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        #gameCanvas {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            background: rgba(0,0,0,0.2);
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <h1>ğŸŒ¸ çš®çš®ç°¡å–®æ¸¬è©¦ ğŸŒ¸</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script type="module">
        import * as me from './node_modules/melonjs/dist/melonjs.module.js';

        // ç°¡å–®çš„çš®çš®é¡
        class SimplePipi extends me.Sprite {
            constructor(x, y) {
                // å‰µå»ºç°¡å–®çš„ç´‹ç†
                const canvas = document.createElement('canvas');
                canvas.width = 32;
                canvas.height = 32;
                const ctx = canvas.getContext('2d');
                
                // ç¹ªè£½ç°¡å–®çš„åœ“å½¢
                ctx.fillStyle = '#FFB6C1';
                ctx.beginPath();
                ctx.arc(16, 16, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // ç¹ªè£½çœ¼ç›
                ctx.fillStyle = '#000000';
                ctx.beginPath();
                ctx.arc(12, 12, 2, 0, Math.PI * 2);
                ctx.arc(20, 12, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // ç¹ªè£½å˜´å·´
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(16, 18, 4, 0, Math.PI);
                ctx.stroke();
                
                super(x, y, {
                    image: canvas,
                    framewidth: 32,
                    frameheight: 32
                });
                
                // ç‰©ç†å±¬æ€§
                this.body = new me.Body(this);
                this.body.addShape(new me.Rect(0, 0, 32, 32));
                this.body.setMaxVelocity(2, 8);
                this.body.setFriction(0.3, 0);
                this.body.collisionType = me.collision.types.PLAYER_OBJECT;
            }
            
            update(dt) {
                // ç°¡å–®çš„å·¦å³ç§»å‹•
                if (this.pos.x < 0) {
                    this.pos.x = 0;
                    this.body.vel.x = 2;
                }
                if (this.pos.x > 768) {
                    this.pos.x = 768;
                    this.body.vel.x = -2;
                }
                
                if (this.body.vel.x === 0) {
                    this.body.vel.x = Math.random() > 0.5 ? 1 : -1;
                }
                
                super.update(dt);
                return true;
            }
        }

        // ç°¡å–®çš„å¹³å°é¡
        class SimplePlatform extends me.Sprite {
            constructor(x, y, width, height) {
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(0, 0, width, height);
                
                super(x, y, {
                    image: canvas,
                    framewidth: width,
                    frameheight: height
                });
                
                this.body = new me.Body(this);
                this.body.addShape(new me.Rect(0, 0, width, height));
                this.body.collisionType = me.collision.types.WORLD_SHAPE;
                this.body.isStatic = true;
            }
        }

        // éŠæˆ²ç‹€æ…‹
        class TestState extends me.Stage {
            onResetEvent() {
                console.log("ç°¡å–®æ¸¬è©¦é–‹å§‹");
                
                // è¨­ç½®é‡åŠ›
                me.game.world.gravity.set(0, 0.98);
                
                // å‰µå»ºçš®çš®
                const pipi = new SimplePipi(100, 100);
                me.game.world.addChild(pipi);
                
                // å‰µå»ºå¹³å°
                const platforms = [
                    new SimplePlatform(0, 550, 800, 50),  // åœ°é¢
                    new SimplePlatform(200, 400, 150, 20), // å¹³å°1
                    new SimplePlatform(400, 300, 150, 20), // å¹³å°2
                ];
                
                platforms.forEach(platform => {
                    me.game.world.addChild(platform);
                });
                
                console.log("çš®çš®å’Œå¹³å°å·²å‰µå»º");
            }
        }

        // åˆå§‹åŒ–
        me.device.onReady(function () {
            console.log("é–‹å§‹åˆå§‹åŒ–...");
            
            if (!me.video.init(800, 600, {
                parent: "gameCanvas", 
                scale: "auto",
                renderer: me.video.CANVAS
            })) {
                alert("ä¸æ”¯æŒ Canvas");
                return;
            }

            console.log("è¦–é »ç³»çµ±åˆå§‹åŒ–å®Œæˆ");
            
            me.game.world.backgroundColor.parseCSS("#87CEEB");
            
            me.state.set(me.state.PLAY, new TestState());
            me.state.change(me.state.PLAY);
            
            console.log("ğŸŒ¸ çš®çš®ç°¡å–®æ¸¬è©¦å®Œæˆï¼ğŸŒ¸");
        });
    </script>
</body>
</html>





